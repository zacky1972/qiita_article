---
title: Elixirの未来トーク1-2「ElixirChip：FPGA or HW化されたElixir」可能性ある社会実装について (Nxバックエンド勉強会#8)
tags:
  - Elixir
  - FPGA
  - RISC-V
  - 宇宙開発
  - nx
private: true
updated_at: '2022-12-01T14:27:57+09:00'
id: a938effa29a79ccdb6d7
organization_url_name: null
slide: false
ignorePublish: false
---
[Nxバックエンド勉強会#8](https://pelemay.connpass.com/event/264838/)でお話しする内容のポジショントークです．

https://pelemay.connpass.com/event/264838/

# はじめに

前の記事では，今までに研究して分かったことを踏まえて，次のような基礎技術を自分で持っておくことの重要性について認識しました．

* マルチコアのRISC-VソフトコアCPUをフルスクラッチで開発すること
* その上で動作するRTOSを開発もしくは移植すること
* BEAM(Erlang VM)をフルスクラッチで開発すること

つまり，自作CPU，自作OS，自作プログラミング言語処理系を開発できるようになっておかないといけないということです．

一方で，これらについてプロフェッショナルとして研究するにあたり，出口となる応用領域について検討する必要があると考えています．このような応用領域の1つとして最近私が取り組んでいる宇宙開発が有望なのではないのか？と考えるようになりました．

この記事では，その点について考察したいと思います．

# 宇宙開発の現状

## 宇宙開発でFPGAは盛んに用いられている

[第66回宇宙科学技術連合講演会](https://branch.jsass.or.jp/ukaren66/)に参加して，宇宙開発でFPGAが盛んに用いられていることを知りました．

FPGAの利点である，消費電力あたりの性能が優れている点と，ハードリアルタイムにしやすいという点が，宇宙開発に向いているとされる点にもなっています．

FPGAで懸念される耐放射線についても，対応できるレベルで，対策もさまざまな観点で研究されていました．

## SAR再生処理の最も高速な処理方法の1つはFPGAを用いる方法である

SAR再生処理により，SAR衛星から得られた生データを処理して空間分解能を大きく向上させて鮮明な地表面の画像を得ることができます．SAR再生処理の原理について学びたい倍位には下記を受講すると良いです．

https://rs-training.jp/e-learning_item/ej20003/

FPGAを用いてSAR再生処理を行う研究が盛んであり，これが現在最も高速なSAR再生処理の方法になっているようです．

## SAR小型衛星上で全てのSAR再生処理を行うのは回路規模と消費電力の観点で難しい

SAR再生処理は，レンジ圧縮とアジマス圧縮という2つで構成されます．レンジ圧縮はレーダーの照射方向の空間分解能を向上させる処理で，アジマス圧縮は衛星進行方向(レーダー照射と直角方向)の空間分解能を向上させる処理です．

詳しくは割愛しますが，SAR小型衛星上のFPGAでこの両方を行うことが回路規模と消費電力の観点で難しいことがわかりました．レンジ圧縮のみを行うことはできそうなのですが，アジマス圧縮まで行うとなると，難しくなります．

## QPS研究所の小型SAR衛星のデータについて，JAXAのデータ処理衛星でSAR再生処理を行うことが発表された

これは表題の通りです．データ処理を衛星上で行うという研究の可能性が提唱されました．

## 特に現在JAXAが取り組んでいる月・火星・小惑星探査にはFPGAを中核としたコンピュータシステムが前提になっている

[宇宙探査イノベーションハブ第9回研究提案募集](https://www.ihub-tansa.jaxa.jp/rfp/rfp9/index.html)でも，FPGAに関する研究の公募がありました．

JAXAは現在，月・火星・小惑星の探査に力を入れていて，地球を周回する衛星軌道の利用については民間に任せるつもりであるのだそうです．

月・火星・小惑星の探査では，画像処理を行う必要があること，コンピュータシステムの消費電力を100ミリワット級に抑える必要があることから，FPGAを中核として構成されるコンピュータシステムを採用する必要があると公募にて表明しています．

## JAXAは，月・火星・小惑星探査向けにFPGA上のマルチコアのソフトコアCPUを求めている

[宇宙探査イノベーションハブ第9回研究提案募集](https://www.ihub-tansa.jaxa.jp/rfp/rfp9/index.html)でのFPGAに関する研究の公募と質疑にて，JAXAは月・火星・小惑星探査向けにFPGA上のマルチコアのソフトコアCPUを求めていることがわかりました．

前述のようにFPGAのソフトコアCPUは，産業用途としては，動作可能なクロック周波数がASICで構成されたCPUより大きく劣る点で優位性に乏しいです．しかし，このような宇宙探査機向けの用途であれば，FPGA上のソフトコアCPUしか選択肢が無いので，実応用として期待されていると言えます．

## JAXAは，FPGA上のマルチコアのソフトコアCPUで動作するRTOSを求めている

[宇宙探査イノベーションハブ第9回研究提案募集](https://www.ihub-tansa.jaxa.jp/rfp/rfp9/index.html)でのFPGAに関する研究の公募と質疑にて，JAXAは，FPGA上のマルチコアのソフトコアCPUで動作するRTOSを求めていることがわかりました．

RTOSとしてはITRONを想定しているが，派生OSでも良いし，なんだったらRTOSだったらなんでもよいというスタンスであることが質疑からわかりました．

## JAXAは次世代宇宙機向けマイクロプロセッサ向けにTOPPERS/HRMP3カーネルを採用した

[TOPPERS/HRMP3カーネルがJAXAの次世代宇宙機向けマイクロプロセッサに採用](https://www.toppers.jp/press/release-1911-02.pdf)

https://www.toppers.jp/press/release-1911-02.pdf

## RISC-V向けのTOPPERSカーネルとしては，TOPPERS/ASPカーネルがある

https://www.toppers.jp/asp-kernel.html

## JAXAは研究開発にデュアル・ユーティライゼーションを求めている

[宇宙探査イノベーションハブ第9回研究提案募集](https://www.ihub-tansa.jaxa.jp/rfp/rfp9/index.html)では，デュアル・ユーティライゼーションということが繰り返し言われていました．これは，宇宙探査だけに使える技術を新規で研究開発するのではなく，地上や宇宙開発の産業でも使える技術を研究開発するということです．

[第66回宇宙科学技術連合講演会](https://branch.jsass.or.jp/ukaren66/)の宇宙探査イノベーションハブのセッションでさらに明確に説明がありました．宇宙探査では従来特注品として開発を進めてきたのですが，それを拡大するのではコスト的に見合わないので，民生の大量生産が期待できるものの中から使いたいということなのだそうです．予算が厳しい中で，このような選択をしないといけないということなのでしょう．

# 考察

以上を踏まえると，少なくとも次の2つの項目については，具体的な産業用途として，月・火星・小惑星の宇宙探査機で使用することが実際に求められているということがわかりました．

* マルチコアのRISC-VソフトコアCPUをフルスクラッチで開発すること
* RTOSを開発もしくは移植し，上記で動かすこと

また，SAR再生処理をデータ処理衛星で行うというQPS研究所とJAXAの野心的な構想を踏まえると，そこにElixirとNxに基づく分散・並列の画像処理・機械学習を入れ込むというのは筋が良さそうに思います．またSAR再生処理を行うのにFPGAが有利であること，人工衛星の消費電力をできるだけ抑える必要性があることを踏まえると，次のような構想が浮かび上がってきます．

* マルチコアのRISC-VソフトコアCPUをフルスクラッチで開発すること
* その上でElixirを動作させること

Elixirを動かすのにLinuxを必要とするというのだと，RISC-VソフトコアCPUに求められる水準が向上してしまう恐れがあります．そこで，次のような線が出てきます．

* マルチコアのRISC-VソフトコアCPUをフルスクラッチで開発すること
* RTOSを開発もしくは移植し，上記で動かすこと
* その上でElixirを動作させること

となると，AtomVMの適用を考えるか，いっそ次のような方向性ですよね！

* マルチコアのRISC-VソフトコアCPUをフルスクラッチで開発すること
* RTOSを開発もしくは移植し，上記で動かすこと
* BEAM(Erlang VM)をフルスクラッチで開発すること
* その上でElixirを動作させること

JAXAの求めるデュアル・ユーティライゼーションの観点で，このような応用が提案できるというのは強みになりそうです！

あとは地上での応用も考えることができれば，さらにデュアル・ユーティライゼーションを推し進めることができそうです．

