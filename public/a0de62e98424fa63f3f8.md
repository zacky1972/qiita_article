---
title: '並行・並列プログラミングと同期・排他制御とイミュータブル性の話〜その1「背景: クロック周波数の停滞とコア数の増加」'
tags:
  - Java
  - C
  - Elixir
private: true
updated_at: '2023-12-17T06:51:11+09:00'
id: a0de62e98424fa63f3f8
organization_url_name: null
slide: false
ignorePublish: false
---
大学の授業で講義資料を作ったので，Qiitaにも展開しておきます．

# 背景: クロック周波数の停滞とコア数の増加

コンピュータはクロック周波数に同期して計算をします．おおむね1秒間にクロック周波数の数で示されるだけの数の機械語命令を実行できると考えると良いです．たとえばクロック周波数が1GHzであれば，1GHz=1,000MHz=1,000,000(百万)kHz=1,000,000,000(10億)Hzですので，1秒間に1,000,000,000(10億)個の機械語命令を実行できるというような感じです．もちろんこれは概算です．

いわゆるヘネパタ本(J. L. Hennessy & D. A. Patterson: Computer Architecture: A Quantitative Approach, 6th edition. Morgan Kaufmann, 2017; 邦訳 中條・天野・鈴木訳: コンピュータアーキテクチャ[第6版]定量的アプローチ, 星雲社, 2019)には，このクロック周波数の伸びについて描かれています．

ヘネパタ本によると，1987〜2003年には1年あたり40％もの伸びがありました．この時代を思い返すと，毎年新しいパワーアップしたCPUが登場し，CPUやPCを買い換えるだけで実行速度がどんどん速くなることを実感した時代でした．

しかし，2003年に3GHz台に到達して以降，急速に伸び悩み，2017年までに1年あたり1％しか伸びていません．

なぜ2003年以降CPUのクロック周波数が急速に伸び悩んだのでしょうか？ それを知るためにはCPUの素子であるCMOSの原理から考察する必要があります．

CMOSというのはComplementary MOS(相補型MOS)ということで，P型とN型のMOSFETを組み合わせたものです．MOSとは，Metal(金属)-Oxide(酸化膜)-Semiconductor(半導体)の略で，酸化膜を挟んで金属と半導体でコンデンサが形成されたものです．FETはField-Effect Transistor(電界効果トランジスタ)ということで，MOSFETはMOSで形成されるコンデンサに充電することで電子の層ができ，それによって導通する方式のトランジスタです．この原理より，クロック周波数の上限をきめる回路遅延はコンデンサの充放電にかかる時間で，消費電力は主にコンデンサへの充放電によるものです．

コンデンサの消費電力は電圧の2乗と静電容量の積に比例します．またクロックサイクルで充放電が1回繰り返されるのでクロック周波数と消費電力は比例します．トランジスタ数が増えると静電容量が比例して増えます．以上を踏まえると，トランジスタの消費電力は電圧の2乗とトランジスタ数とクロック周波数の積に比例します．また発熱量は消費電力に比例します．

ここでムーアの法則「半導体の集積率は18か月で2倍になる」が登場します．これによりトランジスタのサイズは小さくなっていきます．

もしサイズが小さくなるとともに電圧も同じ比率で下げることができたとします．この状況は2000年より前の状況に似ています．前述のコンデンサの静電容量は，トランジスタのサイズに比例して小さくなります．一方，トランジスタ数はサイズの逆数の2乗に比例して増えます．さらに，静電容量が減ることで充電にかかる時間も減るので，遅延が減ります．このことで，サイズに反比例してクロック周波数が向上します．結果としてトータルの消費電力は変わらないので，電力供給量を増強しないで済みました．

しかし2000年過ぎから電圧低下がほぼ止まります．電圧が下がりすぎて，ON/OFFの境界の閾値が0V付近になって，これ以上下げられなくなったからです．

サイズが小さくなるのに電圧が下げられないとなるとどのようになるでしょうか？ トランジスタ数がサイズの逆数の2乗に比例して増える一方で，電圧が下がらないので，遅延が減るからといってそのままサイズに反比例してクロック周波数を向上させると，結果としてトータルの消費電力がサイズの逆数の2乗に比例して増大してしまいます！ 電源ピンに流せる電流量や冷却能力には限界があるので，電力供給量をこれ以上，上げることができません．

そこでクロック周波数を上げるのをやめました．これにより2003年にクロック周波数が3GHzに到達して以降，伸び悩むことになったわけです．

なお，液体窒素等に浸して冷却することで，クロック周波数を大幅に上げることはできます．この方法で2023年1月現在のクロック周波数のワールドレコードは9GHzに達しています．

しかしながら，2000年代以降もムーアの法則「半導体の集積率は18か月で2倍になる」は依然として達成し続けていました．この集積率の向上で1つのCPUに搭載されるトランジスタ数は増え続けています．有り余るトランジスタ数をどのように活かすか？

こうして2000年代以降は，クロック周波数の向上ではなく，コア数の増加やSIMD命令のような並列処理命令の実装に，有り余るトランジスタを活用することになります．

コア数の増加ということで言うと，2006年のx86系CPUの最もコア数の多いCPUであるIntel Core 2 Extreme X6800の物理コア数は2でしたが，2020年のx86系CPUの最もコア数の多いCPUであるAMD Ryzen Threadripper 3990Xの物理コア数は64にもなります． 

しかしながら，このようなCPUの進化の方向性には1つ問題点がありました．CPUのクロック周波数が向上した時には，ソフトウェアを何も書き換えなくても実行速度が向上していたのに対し，コア数が増えたりSIMD命令が備わったりしたとしても，それに対応するようにソフトウェアを**並行・並列プログラミング**によって書き換えないことには実行速度が向上しません．

# 記事シリーズについて

そこで，この記事シリーズでは，並行・並列プログラミングについて，要(かなめ)となる**同期・排他制御**の役割をCとJavaを例に簡単なプログラム例を示します．次に同期・排他制御の問題点をCのプログラム例とともに示します．そしてElixir(エリクサー)によって実現されている，全てを**イミュータブル**にすることによる利点について示します．

シリーズ

1. **並行・並列プログラミングと同期・排他制御とイミュータブル性の話〜その1「背景: クロック周波数の停滞とコア数の増加」**(本記事)
1. [並行・並列プログラミングと同期・排他制御とイミュータブル性の話〜その2「スレッドと同期・排他制御」](https://qiita.com/zacky1972/private/1482c8cc091e82f0cc79)
1. [並行・並列プログラミングと同期・排他制御とイミュータブル性の話〜その3「同期・排他制御の2つの問題点」](https://qiita.com/zacky1972/private/b34077c59784b6cfb71a)
1. [並行・並列プログラミングと同期・排他制御とイミュータブル性の話〜その4「イミュータブル性の利点」](https://qiita.com/zacky1972/private/8330e53feb792f9d55ea)

